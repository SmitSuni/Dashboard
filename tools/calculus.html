<!DOCTYPE html>
<html lang="es" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Calculadora Interactiva de Cálculo: Derivadas, Integrales y Transformada de Laplace">
    <meta name="author" content="Smit Alexander Suni Morales">
    <meta name="keywords" content="cálculo, derivadas, integrales, laplace, matemáticas, ingeniería">

    <meta name="theme-color" content="#0a0e14">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>∫</text></svg>">

    <title>Calculadora de Cálculo - Derivadas, Integrales y Laplace | Smit Alexander</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }

        :root[data-theme="dark"] {
            --bg-primary: #0a0e14; --bg-secondary: #151a21; --bg-tertiary: #1f2937; --bg-card: #1a1f2e;
            --text-primary: #e6e9ef; --text-secondary: #9ca3af; --text-muted: #6b7280;
            --accent-blue: #00d4ff; --accent-green: #00ff88; --accent-purple: #8b5cf6;
            --accent-cyan: #06b6d4; --accent-orange: #ff6b35; --accent-red: #ef4444;
            --border-color: #2d3748; --shadow-md: 0 4px 16px rgba(0,0,0,0.4);
            --shadow-lg: 0 12px 32px rgba(0,0,0,0.6); --shadow-glow: 0 0 20px rgba(0,212,255,0.3);
        }
        :root[data-theme="light"] {
            --bg-primary: #f0f4f8; --bg-secondary: #ffffff; --bg-tertiary: #e2e8f0; --bg-card: #ffffff;
            --text-primary: #1a202c; --text-secondary: #4a5568; --text-muted: #718096;
            --accent-blue: #0088cc; --accent-green: #00cc66; --accent-purple: #7c3aed;
            --accent-cyan: #0891b2; --accent-orange: #ea580c; --accent-red: #dc2626;
            --border-color: #cbd5e0; --shadow-md: 0 4px 16px rgba(0,0,0,0.15);
            --shadow-lg: 0 12px 32px rgba(0,0,0,0.2); --shadow-glow: 0 0 20px rgba(0,136,204,0.2);
        }

        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; background: var(--bg-primary); color: var(--text-primary); min-height: 100vh; line-height: 1.6; transition: all 0.3s; }

        /* Header */
        .header { background: var(--bg-card); border-bottom: 2px solid var(--border-color); padding: 1.5rem 2rem; box-shadow: var(--shadow-md); position: sticky; top: 0; z-index: 100; }
        .header-container { max-width: 1400px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; }
        .header-title { display: flex; align-items: center; gap: 1rem; }
        .header-icon { font-size: 2.5rem; }
        .header-title h1 { font-size: 1.6rem; background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .header-subtitle { font-size: 0.85rem; color: var(--text-muted); margin-top: 0.2rem; }
        .header-actions { display: flex; gap: 1rem; align-items: center; }

        .btn { padding: 0.6rem 1.2rem; background: var(--bg-tertiary); border: 2px solid var(--border-color); border-radius: 8px; color: var(--text-primary); text-decoration: none; font-weight: 600; transition: all 0.3s; display: inline-flex; align-items: center; gap: 0.5rem; cursor: pointer; }
        .btn:hover { border-color: var(--accent-blue); transform: translateY(-2px); box-shadow: var(--shadow-glow); }
        .btn-primary { background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple)); border-color: transparent; color: white; }

        .theme-toggle { width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; position: relative; overflow: hidden; }
        .theme-toggle i { font-size: 1.2rem; position: absolute; transition: all 0.3s; }
        .theme-toggle .fa-sun { color: var(--accent-orange); transform: rotate(0deg); }
        .theme-toggle .fa-moon { color: var(--accent-cyan); transform: rotate(180deg) scale(0); }
        [data-theme="light"] .theme-toggle .fa-sun { transform: rotate(180deg) scale(0); }
        [data-theme="light"] .theme-toggle .fa-moon { transform: rotate(0deg) scale(1); }

        /* Container */
        .container { max-width: 1400px; margin: 0 auto; padding: 2rem; }

        /* Tabs */
        .tabs-container { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 16px; padding: 1.5rem; box-shadow: var(--shadow-md); margin-bottom: 2rem; }
        .tabs-header { display: flex; gap: 0.5rem; flex-wrap: wrap; border-bottom: 2px solid var(--border-color); padding-bottom: 1rem; margin-bottom: 2rem; }
        .tab-btn { padding: 0.8rem 1.5rem; background: var(--bg-secondary); border: 2px solid var(--border-color); border-radius: 8px; color: var(--text-secondary); font-weight: 600; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; gap: 0.5rem; font-size: 0.95rem; }
        .tab-btn:hover { border-color: var(--accent-cyan); color: var(--text-primary); }
        .tab-btn.active { background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple)); border-color: transparent; color: white; box-shadow: var(--shadow-glow); }

        .tab-content { display: none; animation: fadeIn 0.5s; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Info Box */
        .info-box { background: var(--bg-secondary); border-left: 4px solid var(--accent-cyan); padding: 1.2rem; border-radius: 8px; margin-bottom: 1.5rem; }
        .info-box-title { font-weight: 600; color: var(--accent-cyan); margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem; }
        .info-box-text { color: var(--text-secondary); font-size: 0.95rem; line-height: 1.6; }

        /* Input Groups */
        .input-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; }
        .input-group { background: var(--bg-secondary); padding: 1.5rem; border-radius: 12px; border: 1px solid var(--border-color); }
        .input-label { font-size: 0.95rem; font-weight: 600; color: var(--text-secondary); margin-bottom: 0.8rem; display: flex; align-items: center; gap: 0.5rem; }
        .input-field { width: 100%; padding: 0.8rem 1rem; background: var(--bg-tertiary); border: 2px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-size: 1rem; font-weight: 600; transition: all 0.3s; font-family: 'Courier New', monospace; }
        .input-field:focus { outline: none; border-color: var(--accent-blue); box-shadow: 0 0 0 3px rgba(0,212,255,0.1); }
        .unit-text { font-size: 0.85rem; color: var(--text-muted); margin-top: 0.5rem; }

        /* Buttons */
        .calc-btn { width: 100%; padding: 1rem 1.5rem; background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple)); border: none; border-radius: 8px; color: white; font-size: 1.1rem; font-weight: 700; cursor: pointer; transition: all 0.3s; box-shadow: var(--shadow-md); display: flex; align-items: center; justify-content: center; gap: 0.8rem; }
        .calc-btn:hover { transform: translateY(-3px); box-shadow: var(--shadow-lg), var(--shadow-glow); }

        /* Visualization */
        .viz-container { background: var(--bg-secondary); border: 2px solid var(--border-color); border-radius: 12px; padding: 2rem; margin: 2rem 0; }
        .viz-title { font-size: 1.3rem; font-weight: 700; color: var(--text-primary); margin-bottom: 1.5rem; display: flex; align-items: center; justify-content: center; gap: 0.8rem; }
        .svg-canvas { width: 100%; max-width: 900px; height: 450px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-card); margin: 0 auto; display: block; }

        /* Results */
        .results-box { background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary)); border: 2px solid var(--accent-green); border-radius: 12px; padding: 2rem; margin-top: 2rem; }
        .result-title { font-size: 1.3rem; font-weight: 700; color: var(--accent-green); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem; }
        .result-item { background: var(--bg-card); padding: 1rem; border-radius: 8px; margin-bottom: 0.8rem; border-left: 4px solid var(--accent-cyan); }
        .result-label { font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.3rem; }
        .result-value { font-size: 1.5rem; font-weight: 700; color: var(--accent-purple); font-family: 'Courier New', monospace; }

        /* Formula Display */
        .formula-box { background: var(--bg-tertiary); padding: 1.5rem; border-radius: 8px; border: 2px solid var(--accent-purple); margin: 1rem 0; text-align: center; }
        .formula { font-size: 1.3rem; font-weight: 600; color: var(--accent-purple); font-family: 'Courier New', monospace; margin: 0.5rem 0; }

        /* Examples */
        .examples-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem; }
        .example-btn { padding: 0.8rem 1rem; background: var(--bg-tertiary); border: 2px solid var(--border-color); border-radius: 8px; cursor: pointer; transition: all 0.3s; text-align: center; }
        .example-btn:hover { border-color: var(--accent-cyan); transform: translateY(-2px); }
        .example-label { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 0.3rem; }
        .example-value { font-size: 1.1rem; font-weight: 600; color: var(--accent-cyan); font-family: 'Courier New', monospace; }

        /* Slider */
        .slider-container { margin: 1rem 0; }
        .slider-label { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; }
        .slider-value { color: var(--accent-cyan); font-size: 1.1rem; font-weight: 700; }
        .slider { -webkit-appearance: none; appearance: none; width: 100%; height: 8px; border-radius: 5px; background: var(--bg-tertiary); outline: none; }
        .slider::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 20px; height: 20px; border-radius: 50%; background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple)); cursor: pointer; box-shadow: 0 2px 8px rgba(0,212,255,0.5); }
        .slider::-moz-range-thumb { width: 20px; height: 20px; border-radius: 50%; background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple)); cursor: pointer; border: none; box-shadow: 0 2px 8px rgba(0,212,255,0.5); }

        /* Laplace Table */
        .laplace-table { width: 100%; border-collapse: collapse; margin: 1rem 0; }
        .laplace-table th, .laplace-table td { padding: 1rem; border: 1px solid var(--border-color); text-align: left; }
        .laplace-table th { background: var(--bg-tertiary); color: var(--accent-cyan); font-weight: 600; }
        .laplace-table td { background: var(--bg-secondary); font-family: 'Courier New', monospace; }
        .laplace-select { padding: 0.8rem; background: var(--bg-tertiary); border: 2px solid var(--border-color); border-radius: 6px; color: var(--text-primary); font-size: 1rem; width: 100%; cursor: pointer; }

        /* Footer */
        .footer { text-align: center; padding: 2rem; border-top: 1px solid var(--border-color); margin-top: 3rem; color: var(--text-muted); }

        /* Animations */
        .animated-curve { opacity: 0; animation: drawCurve 1s ease-out forwards; }
        @keyframes drawCurve { to { opacity: 1; } }

        @media (max-width: 768px) {
            .header-title h1 { font-size: 1.2rem; }
            .tabs-header { gap: 0.3rem; }
            .tab-btn { padding: 0.6rem 1rem; font-size: 0.85rem; }
            .input-grid { grid-template-columns: 1fr; }
            .svg-canvas { height: 350px; }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-container">
            <div class="header-title">
                <span class="header-icon">∫</span>
                <div>
                    <h1>Calculadora de Cálculo Diferencial e Integral</h1>
                    <div class="header-subtitle">Derivadas, Integrales y Transformada de Laplace | Ingeniería</div>
                </div>
            </div>
            <div class="header-actions">
                <button class="btn theme-toggle" id="theme-toggle">
                    <i class="fas fa-sun"></i>
                    <i class="fas fa-moon"></i>
                </button>
                <a href="../index.html" class="btn btn-primary">
                    <i class="fas fa-home"></i>
                    Dashboard
                </a>
            </div>
        </div>
    </header>

    <main class="container">
        <div class="tabs-container">
            <div class="tabs-header">
                <button class="tab-btn active" data-tab="derivatives"><i class="fas fa-chart-line"></i> Derivadas</button>
                <button class="tab-btn" data-tab="integrals"><i class="fas fa-wave-square"></i> Integrales</button>
                <button class="tab-btn" data-tab="laplace"><i class="fas fa-infinity"></i> Laplace</button>
            </div>

            <!-- TAB 1: Derivadas -->
            <div class="tab-content active" id="derivatives">
                <div class="info-box">
                    <div class="info-box-title"><i class="fas fa-info-circle"></i> Derivadas con Visualización</div>
                    <p class="info-box-text">Calcula la derivada numérica de una función y visualiza f(x), f'(x) y la recta tangente en un punto. Usa notación JavaScript estándar.</p>
                </div>

                <div class="input-grid">
                    <div class="input-group">
                        <label class="input-label"><i class="fas fa-function"></i> Función f(x)</label>
                        <input type="text" class="input-field" id="derivFunc" value="x*x" placeholder="Ejemplo: x*x, sin(x), exp(x)">
                        <div class="unit-text">Usa: +, -, *, /, ^, sin, cos, tan, exp, log, sqrt, abs</div>
                    </div>
                    <div class="input-group">
                        <label class="input-label"><i class="fas fa-map-pin"></i> Punto x₀</label>
                        <input type="number" class="input-field" id="derivPoint" value="2" step="0.1">
                        <div class="unit-text">Punto donde calcular la derivada</div>
                    </div>
                </div>

                <div class="examples-grid">
                    <div class="example-btn" onclick="setDerivExample('x*x', 2)">
                        <div class="example-label">Parábola</div>
                        <div class="example-value">x²</div>
                    </div>
                    <div class="example-btn" onclick="setDerivExample('sin(x)', 0)">
                        <div class="example-label">Seno</div>
                        <div class="example-value">sin(x)</div>
                    </div>
                    <div class="example-btn" onclick="setDerivExample('exp(x)', 1)">
                        <div class="example-label">Exponencial</div>
                        <div class="example-value">eˣ</div>
                    </div>
                    <div class="example-btn" onclick="setDerivExample('1/x', 2)">
                        <div class="example-label">Inverso</div>
                        <div class="example-value">1/x</div>
                    </div>
                </div>

                <button class="calc-btn" onclick="calculateDerivative()"><i class="fas fa-calculator"></i> Calcular Derivada</button>

                <div class="viz-container" id="derivViz" style="display:none;">
                    <div class="viz-title"><i class="fas fa-chart-area"></i> Gráfico de f(x), f'(x) y Tangente</div>
                    <svg class="svg-canvas" id="derivSVG" viewBox="0 0 900 450"></svg>
                </div>

                <div class="results-box" id="derivResults" style="display:none;">
                    <div class="result-title"><i class="fas fa-check-circle"></i> Resultados</div>
                    <div class="result-item">
                        <div class="result-label">Valor de f(x₀)</div>
                        <div class="result-value" id="derivFx">0</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Derivada f'(x₀)</div>
                        <div class="result-value" id="derivDfx">0</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Ecuación de la Tangente</div>
                        <div class="result-value" id="derivTangent">y = mx + b</div>
                    </div>
                </div>
            </div>

            <!-- TAB 2: Integrales Definidas -->
            <div class="tab-content" id="integrals">
                <div class="info-box">
                    <div class="info-box-title"><i class="fas fa-info-circle"></i> Integrales Definidas Numéricas</div>
                    <p class="info-box-text">Calcula integrales definidas usando métodos numéricos (Simpson, Trapecio). Visualiza el área bajo la curva con animación.</p>
                </div>

                <div class="input-grid">
                    <div class="input-group">
                        <label class="input-label"><i class="fas fa-function"></i> Función f(x)</label>
                        <input type="text" class="input-field" id="integFunc" value="x*x" placeholder="Ejemplo: x*x, sin(x), exp(x)">
                        <div class="unit-text">Función a integrar</div>
                    </div>
                    <div class="input-group">
                        <label class="input-label"><i class="fas fa-arrows-alt-h"></i> Límite inferior (a)</label>
                        <input type="number" class="input-field" id="integA" value="0" step="0.1">
                    </div>
                    <div class="input-group">
                        <label class="input-label"><i class="fas fa-arrows-alt-h"></i> Límite superior (b)</label>
                        <input type="number" class="input-field" id="integB" value="2" step="0.1">
                    </div>
                    <div class="input-group">
                        <label class="input-label"><i class="fas fa-cogs"></i> Método</label>
                        <select class="input-field" id="integMethod">
                            <option value="simpson">Simpson (más preciso)</option>
                            <option value="trapezoid">Trapecio (rápido)</option>
                        </select>
                    </div>
                </div>

                <div class="slider-container">
                    <div class="slider-label">
                        <span><i class="fas fa-sliders-h"></i> Número de particiones</span>
                        <span class="slider-value" id="partitionsValue">20</span>
                    </div>
                    <input type="range" class="slider" id="partitions" min="4" max="100" step="2" value="20">
                </div>

                <div class="examples-grid">
                    <div class="example-btn" onclick="setIntegExample('x*x', 0, 2)">
                        <div class="example-label">Parábola</div>
                        <div class="example-value">∫ x² dx</div>
                    </div>
                    <div class="example-btn" onclick="setIntegExample('sin(x)', 0, 3.14159)">
                        <div class="example-label">Seno</div>
                        <div class="example-value">∫ sin(x) dx</div>
                    </div>
                    <div class="example-btn" onclick="setIntegExample('exp(-x*x)', -2, 2)">
                        <div class="example-label">Gaussiana</div>
                        <div class="example-value">∫ e^(-x²) dx</div>
                    </div>
                    <div class="example-btn" onclick="setIntegExample('1/(1+x*x)', 0, 1)">
                        <div class="example-label">Arctangente</div>
                        <div class="example-value">∫ 1/(1+x²) dx</div>
                    </div>
                </div>

                <button class="calc-btn" onclick="calculateIntegral()"><i class="fas fa-calculator"></i> Calcular Integral</button>

                <div class="viz-container" id="integViz" style="display:none;">
                    <div class="viz-title"><i class="fas fa-chart-area"></i> Área bajo la Curva</div>
                    <svg class="svg-canvas" id="integSVG" viewBox="0 0 900 450"></svg>
                </div>

                <div class="results-box" id="integResults" style="display:none;">
                    <div class="result-title"><i class="fas fa-check-circle"></i> Resultado</div>
                    <div class="formula-box">
                        <div class="formula" id="integFormula">∫ f(x) dx</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Valor de la Integral</div>
                        <div class="result-value" id="integValue">0</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Método Utilizado</div>
                        <div class="result-value" id="integMethodUsed">Simpson</div>
                    </div>
                </div>
            </div>

            <!-- TAB 3: Transformada de Laplace -->
            <div class="tab-content" id="laplace">
                <div class="info-box">
                    <div class="info-box-title"><i class="fas fa-info-circle"></i> Transformada de Laplace</div>
                    <p class="info-box-text">Tabla de transformadas de Laplace comunes. Selecciona una función f(t) e ingresa los parámetros para obtener F(s). Útil para resolver ecuaciones diferenciales.</p>
                </div>

                <div class="input-group">
                    <label class="input-label"><i class="fas fa-list"></i> Selecciona una transformada</label>
                    <select class="laplace-select" id="laplaceFunction" onchange="updateLaplaceParams()">
                        <option value="constant">Constante: f(t) = k</option>
                        <option value="power">Potencia: f(t) = t^n</option>
                        <option value="exp">Exponencial: f(t) = e^(at)</option>
                        <option value="sin">Seno: f(t) = sin(ωt)</option>
                        <option value="cos">Coseno: f(t) = cos(ωt)</option>
                        <option value="exp_sin">Exp-Seno: f(t) = e^(at)·sin(ωt)</option>
                        <option value="exp_cos">Exp-Coseno: f(t) = e^(at)·cos(ωt)</option>
                        <option value="sinh">Seno hiperbólico: f(t) = sinh(at)</option>
                        <option value="cosh">Coseno hiperbólico: f(t) = cosh(at)</option>
                    </select>
                </div>

                <div class="input-grid" id="laplaceParams">
                    <!-- Los parámetros se cargarán dinámicamente -->
                </div>

                <button class="calc-btn" onclick="calculateLaplace()"><i class="fas fa-calculator"></i> Calcular Transformada</button>

                <div class="results-box" id="laplaceResults" style="display:none;">
                    <div class="result-title"><i class="fas fa-infinity"></i> Transformada de Laplace</div>
                    <div class="result-item">
                        <div class="result-label">f(t) en el dominio temporal</div>
                        <div class="result-value" id="laplaceFt">f(t)</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">ℒ{f(t)} = F(s) en el dominio de Laplace</div>
                        <div class="result-value" id="laplaceFs">F(s)</div>
                    </div>
                    <div class="result-item">
                        <div class="result-label">Condición de convergencia</div>
                        <div class="result-value" id="laplaceCondition">Re(s) > a</div>
                    </div>
                </div>

                <div class="info-box" style="margin-top: 2rem;">
                    <div class="info-box-title"><i class="fas fa-book"></i> Tabla de Transformadas Comunes</div>
                    <table class="laplace-table">
                        <thead>
                            <tr>
                                <th>f(t)</th>
                                <th>F(s) = ℒ{f(t)}</th>
                                <th>Condición</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td>1</td><td>1/s</td><td>s > 0</td></tr>
                            <tr><td>t</td><td>1/s²</td><td>s > 0</td></tr>
                            <tr><td>t^n</td><td>n!/s^(n+1)</td><td>s > 0</td></tr>
                            <tr><td>e^(at)</td><td>1/(s-a)</td><td>s > a</td></tr>
                            <tr><td>sin(ωt)</td><td>ω/(s²+ω²)</td><td>s > 0</td></tr>
                            <tr><td>cos(ωt)</td><td>s/(s²+ω²)</td><td>s > 0</td></tr>
                            <tr><td>e^(at)·sin(ωt)</td><td>ω/((s-a)²+ω²)</td><td>s > a</td></tr>
                            <tr><td>e^(at)·cos(ωt)</td><td>(s-a)/((s-a)²+ω²)</td><td>s > a</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <p>&copy; 2025 Smit Alexander Suni Morales. Todos los derechos reservados.</p>
        <p style="margin-top: 0.5rem; color: var(--accent-cyan);">
            Calculadora de Cálculo Diferencial e Integral | Ingeniería Estadística e Informática
        </p>
    </footer>

    <script>
        // Theme Toggle
        function initTheme() {
            const theme = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-theme', theme);
            document.getElementById('theme-toggle').addEventListener('click', () => {
                const current = document.documentElement.getAttribute('data-theme');
                const newTheme = current === 'dark' ? 'light' : 'dark';
                document.documentElement.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
            });
        }

        // Tabs System
        function initTabs() {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const target = btn.getAttribute('data-tab');
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    btn.classList.add('active');
                    document.getElementById(target).classList.add('active');
                });
            });
        }

        // Get theme colors
        function getColors() {
            const theme = document.documentElement.getAttribute('data-theme');
            return {
                primary: theme === 'dark' ? '#00d4ff' : '#0088cc',
                secondary: theme === 'dark' ? '#00ff88' : '#00cc66',
                purple: theme === 'dark' ? '#8b5cf6' : '#7c3aed',
                orange: theme === 'dark' ? '#ff6b35' : '#ea580c',
                text: theme === 'dark' ? '#e6e9ef' : '#1a202c',
                grid: theme === 'dark' ? '#2d3748' : '#cbd5e0',
                bg: theme === 'dark' ? '#1a1f2e' : '#ffffff'
            };
        }

        // ===== PARSER DE EXPRESIONES MATEMÁTICAS =====
        function parseExpression(expr) {
            // Reemplazar operadores y funciones por JavaScript estándar
            expr = expr.replace(/\^/g, '**'); // Potencias
            expr = expr.replace(/sin/g, 'Math.sin');
            expr = expr.replace(/cos/g, 'Math.cos');
            expr = expr.replace(/tan/g, 'Math.tan');
            expr = expr.replace(/exp/g, 'Math.exp');
            expr = expr.replace(/log/g, 'Math.log');
            expr = expr.replace(/sqrt/g, 'Math.sqrt');
            expr = expr.replace(/abs/g, 'Math.abs');
            expr = expr.replace(/pi/g, 'Math.PI');

            return (x) => {
                try {
                    return eval(expr.replace(/x/g, `(${x})`));
                } catch (e) {
                    console.error('Error evaluando expresión:', e);
                    return NaN;
                }
            };
        }

        // ===== DERIVADAS =====
        function calculateDerivative() {
            try {
                const funcStr = document.getElementById('derivFunc').value;
                const x0 = parseFloat(document.getElementById('derivPoint').value);
                const f = parseExpression(funcStr);

                // Derivada numérica usando diferencias centrales
                const h = 0.0001;
                const df = (f(x0 + h) - f(x0 - h)) / (2 * h);
                const fx0 = f(x0);

                // Ecuación de la tangente: y - f(x0) = f'(x0)(x - x0)
                // y = f'(x0)·x + (f(x0) - f'(x0)·x0)
                const m = df;
                const b = fx0 - df * x0;

                // Mostrar resultados
                document.getElementById('derivFx').textContent = fx0.toFixed(6);
                document.getElementById('derivDfx').textContent = df.toFixed(6);
                document.getElementById('derivTangent').textContent = `y = ${m.toFixed(4)}x ${b >= 0 ? '+' : ''}${b.toFixed(4)}`;

                // Dibujar gráfico
                drawDerivativeGraph(f, x0, fx0, df);

                document.getElementById('derivViz').style.display = 'block';
                document.getElementById('derivResults').style.display = 'block';
            } catch (error) {
                alert('Error al calcular la derivada: ' + error.message);
                console.error(error);
            }
        }

        function drawDerivativeGraph(f, x0, fx0, df) {
            const svg = document.getElementById('derivSVG');
            svg.innerHTML = '';
            const colors = getColors();

            const width = 900, height = 450;
            const margin = { top: 40, right: 40, bottom: 60, left: 60 };
            const plotWidth = width - margin.left - margin.right;
            const plotHeight = height - margin.top - margin.bottom;

            // Determinar rango
            const xMin = x0 - 5;
            const xMax = x0 + 5;
            const xScale = (x) => margin.left + ((x - xMin) / (xMax - xMin)) * plotWidth;

            // Calcular rango y
            let yMin = Infinity, yMax = -Infinity;
            for (let x = xMin; x <= xMax; x += 0.1) {
                const y = f(x);
                if (!isNaN(y) && isFinite(y)) {
                    yMin = Math.min(yMin, y);
                    yMax = Math.max(yMax, y);
                }
            }
            const yPadding = (yMax - yMin) * 0.2;
            yMin -= yPadding;
            yMax += yPadding;
            const yScale = (y) => margin.top + plotHeight - ((y - yMin) / (yMax - yMin)) * plotHeight;

            // Dibujar ejes
            svg.innerHTML += `<line x1="${margin.left}" y1="${yScale(0)}" x2="${width - margin.right}" y2="${yScale(0)}" stroke="${colors.grid}" stroke-width="1"/>`;
            svg.innerHTML += `<line x1="${xScale(0)}" y1="${margin.top}" x2="${xScale(0)}" y2="${margin.top + plotHeight}" stroke="${colors.grid}" stroke-width="1"/>`;

            // Dibujar f(x)
            let pathF = '';
            for (let i = 0; i <= 200; i++) {
                const x = xMin + (xMax - xMin) * i / 200;
                const y = f(x);
                if (!isNaN(y) && isFinite(y)) {
                    const xPos = xScale(x);
                    const yPos = yScale(y);
                    pathF += (pathF === '' ? 'M' : 'L') + ` ${xPos} ${yPos}`;
                }
            }
            svg.innerHTML += `<path d="${pathF}" fill="none" stroke="${colors.primary}" stroke-width="3" class="animated-curve"/>`;

            // Dibujar tangente
            const tangentX1 = xMin;
            const tangentX2 = xMax;
            const tangentY1 = df * tangentX1 + (fx0 - df * x0);
            const tangentY2 = df * tangentX2 + (fx0 - df * x0);
            svg.innerHTML += `<line x1="${xScale(tangentX1)}" y1="${yScale(tangentY1)}" x2="${xScale(tangentX2)}" y2="${yScale(tangentY2)}" stroke="${colors.orange}" stroke-width="2" stroke-dasharray="5,5"/>`;

            // Punto
            svg.innerHTML += `<circle cx="${xScale(x0)}" cy="${yScale(fx0)}" r="6" fill="${colors.purple}" stroke="white" stroke-width="2"/>`;

            // Labels
            svg.innerHTML += `<text x="${width/2}" y="30" fill="${colors.text}" font-size="16" font-weight="bold" text-anchor="middle">f(x) y Tangente en x=${x0}</text>`;
            svg.innerHTML += `<text x="${width - 120}" y="70" fill="${colors.primary}" font-size="14">— f(x)</text>`;
            svg.innerHTML += `<text x="${width - 120}" y="90" fill="${colors.orange}" font-size="14">- - Tangente</text>`;
        }

        function setDerivExample(func, point) {
            document.getElementById('derivFunc').value = func;
            document.getElementById('derivPoint').value = point;
        }

        // ===== INTEGRALES =====
        document.getElementById('partitions').addEventListener('input', (e) => {
            document.getElementById('partitionsValue').textContent = e.target.value;
        });

        function calculateIntegral() {
            try {
                const funcStr = document.getElementById('integFunc').value;
                const a = parseFloat(document.getElementById('integA').value);
                const b = parseFloat(document.getElementById('integB').value);
                const method = document.getElementById('integMethod').value;
                const n = parseInt(document.getElementById('partitions').value);
                const f = parseExpression(funcStr);

                let result;
                if (method === 'simpson') {
                    result = simpsonRule(f, a, b, n);
                } else {
                    result = trapezoidRule(f, a, b, n);
                }

                // Mostrar resultados
                document.getElementById('integFormula').textContent = `∫[${a},${b}] ${funcStr} dx`;
                document.getElementById('integValue').textContent = result.toFixed(6);
                document.getElementById('integMethodUsed').textContent = method === 'simpson' ? 'Regla de Simpson' : 'Regla del Trapecio';

                // Dibujar gráfico
                drawIntegralGraph(f, a, b, n, method);

                document.getElementById('integViz').style.display = 'block';
                document.getElementById('integResults').style.display = 'block';
            } catch (error) {
                alert('Error al calcular la integral: ' + error.message);
                console.error(error);
            }
        }

        function trapezoidRule(f, a, b, n) {
            const h = (b - a) / n;
            let sum = 0.5 * (f(a) + f(b));

            for (let i = 1; i < n; i++) {
                sum += f(a + i * h);
            }

            return h * sum;
        }

        function simpsonRule(f, a, b, n) {
            if (n % 2 !== 0) n++; // Simpson requiere n par
            const h = (b - a) / n;
            let sum = f(a) + f(b);

            for (let i = 1; i < n; i++) {
                const coef = (i % 2 === 0) ? 2 : 4;
                sum += coef * f(a + i * h);
            }

            return (h / 3) * sum;
        }

        function drawIntegralGraph(f, a, b, n, method) {
            const svg = document.getElementById('integSVG');
            svg.innerHTML = '';
            const colors = getColors();

            const width = 900, height = 450;
            const margin = { top: 40, right: 40, bottom: 60, left: 60 };
            const plotWidth = width - margin.left - margin.right;
            const plotHeight = height - margin.top - margin.bottom;

            const xMin = a - (b - a) * 0.2;
            const xMax = b + (b - a) * 0.2;
            const xScale = (x) => margin.left + ((x - xMin) / (xMax - xMin)) * plotWidth;

            // Calcular rango y
            let yMin = 0, yMax = -Infinity;
            for (let x = a; x <= b; x += (b - a) / 100) {
                const y = f(x);
                if (!isNaN(y) && isFinite(y)) {
                    yMin = Math.min(yMin, y);
                    yMax = Math.max(yMax, y);
                }
            }
            yMin = Math.min(0, yMin);
            const yPadding = (yMax - yMin) * 0.2;
            yMin -= yPadding;
            yMax += yPadding;
            const yScale = (y) => margin.top + plotHeight - ((y - yMin) / (yMax - yMin)) * plotHeight;

            // Dibujar área bajo la curva
            const h = (b - a) / n;
            for (let i = 0; i < n; i++) {
                const x1 = a + i * h;
                const x2 = a + (i + 1) * h;
                const y1 = f(x1);
                const y2 = f(x2);

                if (method === 'trapezoid') {
                    // Trapecio
                    const path = `M ${xScale(x1)} ${yScale(0)} L ${xScale(x1)} ${yScale(y1)} L ${xScale(x2)} ${yScale(y2)} L ${xScale(x2)} ${yScale(0)} Z`;
                    svg.innerHTML += `<path d="${path}" fill="${colors.primary}" opacity="0.3" stroke="${colors.primary}" stroke-width="1"/>`;
                } else {
                    // Simpson (aproximación con rectángulos)
                    const xMid = (x1 + x2) / 2;
                    const yMid = f(xMid);
                    const rectHeight = yMid;
                    const rect = `M ${xScale(x1)} ${yScale(0)} L ${xScale(x1)} ${yScale(rectHeight)} L ${xScale(x2)} ${yScale(rectHeight)} L ${xScale(x2)} ${yScale(0)} Z`;
                    svg.innerHTML += `<path d="${rect}" fill="${colors.primary}" opacity="0.3" stroke="${colors.primary}" stroke-width="1"/>`;
                }
            }

            // Dibujar curva
            let pathF = '';
            for (let i = 0; i <= 200; i++) {
                const x = xMin + (xMax - xMin) * i / 200;
                const y = f(x);
                if (!isNaN(y) && isFinite(y)) {
                    pathF += (pathF === '' ? 'M' : 'L') + ` ${xScale(x)} ${yScale(y)}`;
                }
            }
            svg.innerHTML += `<path d="${pathF}" fill="none" stroke="${colors.purple}" stroke-width="3"/>`;

            // Ejes
            svg.innerHTML += `<line x1="${margin.left}" y1="${yScale(0)}" x2="${width - margin.right}" y2="${yScale(0)}" stroke="${colors.grid}" stroke-width="2"/>`;
            svg.innerHTML += `<line x1="${xScale(0)}" y1="${margin.top}" x2="${xScale(0)}" y2="${margin.top + plotHeight}" stroke="${colors.grid}" stroke-width="1"/>`;

            // Límites
            svg.innerHTML += `<line x1="${xScale(a)}" y1="${margin.top}" x2="${xScale(a)}" y2="${margin.top + plotHeight}" stroke="${colors.secondary}" stroke-width="2" stroke-dasharray="5,5"/>`;
            svg.innerHTML += `<line x1="${xScale(b)}" y1="${margin.top}" x2="${xScale(b)}" y2="${margin.top + plotHeight}" stroke="${colors.secondary}" stroke-width="2" stroke-dasharray="5,5"/>`;

            svg.innerHTML += `<text x="${width/2}" y="30" fill="${colors.text}" font-size="16" font-weight="bold" text-anchor="middle">∫[${a},${b}] f(x) dx con ${n} particiones</text>`;
        }

        function setIntegExample(func, a, b) {
            document.getElementById('integFunc').value = func;
            document.getElementById('integA').value = a;
            document.getElementById('integB').value = b;
        }

        // ===== TRANSFORMADA DE LAPLACE =====
        function updateLaplaceParams() {
            const funcType = document.getElementById('laplaceFunction').value;
            const container = document.getElementById('laplaceParams');
            container.innerHTML = '';

            switch(funcType) {
                case 'constant':
                    container.innerHTML = `
                        <div class="input-group">
                            <label class="input-label"><i class="fas fa-hashtag"></i> Constante k</label>
                            <input type="number" class="input-field" id="paramK" value="1" step="0.1">
                        </div>
                    `;
                    break;
                case 'power':
                    container.innerHTML = `
                        <div class="input-group">
                            <label class="input-label"><i class="fas fa-superscript"></i> Exponente n</label>
                            <input type="number" class="input-field" id="paramN" value="2" step="1" min="0">
                        </div>
                    `;
                    break;
                case 'exp':
                    container.innerHTML = `
                        <div class="input-group">
                            <label class="input-label"><i class="fas fa-chart-line"></i> Parámetro a</label>
                            <input type="number" class="input-field" id="paramA" value="2" step="0.1">
                        </div>
                    `;
                    break;
                case 'sin':
                case 'cos':
                    container.innerHTML = `
                        <div class="input-group">
                            <label class="input-label"><i class="fas fa-wave-square"></i> Frecuencia ω</label>
                            <input type="number" class="input-field" id="paramW" value="3" step="0.1">
                        </div>
                    `;
                    break;
                case 'exp_sin':
                case 'exp_cos':
                    container.innerHTML = `
                        <div class="input-group">
                            <label class="input-label"><i class="fas fa-chart-line"></i> Parámetro a</label>
                            <input type="number" class="input-field" id="paramA" value="2" step="0.1">
                        </div>
                        <div class="input-group">
                            <label class="input-label"><i class="fas fa-wave-square"></i> Frecuencia ω</label>
                            <input type="number" class="input-field" id="paramW" value="3" step="0.1">
                        </div>
                    `;
                    break;
                case 'sinh':
                case 'cosh':
                    container.innerHTML = `
                        <div class="input-group">
                            <label class="input-label"><i class="fas fa-chart-line"></i> Parámetro a</label>
                            <input type="number" class="input-field" id="paramA" value="2" step="0.1">
                        </div>
                    `;
                    break;
            }
        }

        function calculateLaplace() {
            const funcType = document.getElementById('laplaceFunction').value;
            let ft = '', Fs = '', condition = '';

            switch(funcType) {
                case 'constant':
                    const k = parseFloat(document.getElementById('paramK').value);
                    ft = `${k}`;
                    Fs = `${k}/s`;
                    condition = 's > 0';
                    break;
                case 'power':
                    const n = parseInt(document.getElementById('paramN').value);
                    ft = `t^${n}`;
                    const factorial = (n) => n <= 1 ? 1 : n * factorial(n - 1);
                    Fs = `${factorial(n)}/s^${n + 1}`;
                    condition = 's > 0';
                    break;
                case 'exp':
                    const a = parseFloat(document.getElementById('paramA').value);
                    ft = `e^(${a}t)`;
                    Fs = `1/(s - ${a})`;
                    condition = `s > ${a}`;
                    break;
                case 'sin':
                    const w1 = parseFloat(document.getElementById('paramW').value);
                    ft = `sin(${w1}t)`;
                    Fs = `${w1}/(s² + ${w1 * w1})`;
                    condition = 's > 0';
                    break;
                case 'cos':
                    const w2 = parseFloat(document.getElementById('paramW').value);
                    ft = `cos(${w2}t)`;
                    Fs = `s/(s² + ${w2 * w2})`;
                    condition = 's > 0';
                    break;
                case 'exp_sin':
                    const a1 = parseFloat(document.getElementById('paramA').value);
                    const w3 = parseFloat(document.getElementById('paramW').value);
                    ft = `e^(${a1}t)·sin(${w3}t)`;
                    Fs = `${w3}/((s - ${a1})² + ${w3 * w3})`;
                    condition = `s > ${a1}`;
                    break;
                case 'exp_cos':
                    const a2 = parseFloat(document.getElementById('paramA').value);
                    const w4 = parseFloat(document.getElementById('paramW').value);
                    ft = `e^(${a2}t)·cos(${w4}t)`;
                    Fs = `(s - ${a2})/((s - ${a2})² + ${w4 * w4})`;
                    condition = `s > ${a2}`;
                    break;
                case 'sinh':
                    const a3 = parseFloat(document.getElementById('paramA').value);
                    ft = `sinh(${a3}t)`;
                    Fs = `${a3}/(s² - ${a3 * a3})`;
                    condition = `s > |${a3}|`;
                    break;
                case 'cosh':
                    const a4 = parseFloat(document.getElementById('paramA').value);
                    ft = `cosh(${a4}t)`;
                    Fs = `s/(s² - ${a4 * a4})`;
                    condition = `s > |${a4}|`;
                    break;
            }

            document.getElementById('laplaceFt').textContent = ft;
            document.getElementById('laplaceFs').textContent = Fs;
            document.getElementById('laplaceCondition').textContent = condition;
            document.getElementById('laplaceResults').style.display = 'block';
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initTheme();
            initTabs();
            updateLaplaceParams();
            console.log('∫ Calculadora de Cálculo - Cargada ✓');
        });
    </script>
</body>
</html>
